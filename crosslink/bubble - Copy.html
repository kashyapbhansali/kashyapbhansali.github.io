<!DOCTYPE html><meta charset=utf-8><style>.main{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1000}#m1{height:20%}#m2{height:24%}#m3{height:18%}#m4{height:38%}#f1{height:23%}#f2{height:23%}#f3{height:16%}#f4{height:38%}text{font-size:14px}path.chord{fill-opacity:.8}.node{cursor:pointer}.node:hover{stroke:#000;stroke-width:1.5px}.node--leaf{fill:#fff}.label{font:13px "Helvetica Neue",Helvetica,Arial,sans-serif;text-anchor:middle;text-shadow:0 1px 0 #fff,1px 0 0 #fff,-1px 0 0 #fff,0 -1px 0 #fff}.label,.node--leaf,.node--root{pointer-events:auto}.space{display:inline-block;vertical-align:text-top}.holder{margin:20px;width:400px;height:400px;position:relative}.men{position:absolute;z-index:1;top:0;left:0;width:50%;height:100%}.women{position:absolute;z-index:1;top:0;right:0;width:50%;height:100%}.heading{height:45px;background-color:#383838;text-align:center;color:#fff}.heading h3{padding:0;margin:0;font-family:"Century Gothic";font-size:1.5em}body{margin:0;padding:0;background:#f9f9f9}.placeholder{height:10px}.bub{margin:20px}.axis line,.axis path{fill:none;stroke:#000;shape-rendering:crispEdges}.x.axis path{display:none}.line{fill:none;stroke:#4682b4;stroke-width:1.5px}.overlay{fill:none;pointer-events:all}.focus1 circle{fill:none;stroke:#4682b4}</style><div class="space bub"><svg height=400 id=bubble width=400></svg></div><div id=body class=space><div id=footer><div class=hint></div></div></div><div class="space holder"><div class=main><img height=100% src=humans1.png width=100%></div><div class=men><div id=m1></div><div id=m2></div><div id=m3></div><div id=m4></div></div><div class=women><div id=f1></div><div id=f2></div><div id=f3></div><div id=f4></div></div></div><div class="space lin"><svg height=800 id=line width=800></svg></div><div class="space questions"></div><script src=https://d3js.org/d3.v4.min.js></script><script>var d3v4=d3,svg=d3v4.select("#bubble"),margin=20,diameter=+svg.attr("width"),g=svg.append("g").attr("transform","translate("+diameter/2+","+diameter/2+")"),color=d3v4.scaleLinear().domain([-1,5]).range(["hsl(152,80%,80%)","hsl(228,30%,40%)"]).interpolate(d3v4.interpolateHcl),pack=d3v4.pack().size([diameter-margin,diameter-margin]).padding(2);d3v4.json("bubble.json",function(t,e){function n(t){i=t,console.log("focus1: "+i+"   d= "+t);var e=d3v4.transition().duration(d3v4.event.altKey?7500:750).tween("zoom",function(t){var e=d3v4.interpolateZoom(r,[i.x,i.y,2*i.r+margin]);return function(t){a(e(t))}});e.selectAll("#bubble text").filter(function(t){return t.parent===i||"inline"===this.style.display}).style("fill-opacity",function(t){return t.parent===i?1:0}).on("start",function(t){t.parent===i&&(this.style.display="inline")}).on("end",function(t){t.parent!==i&&(this.style.display="none")})}function a(t){var e=diameter/t[2];r=t,c.attr("transform",function(n){return"translate("+(n.x-t[0])*e+","+(n.y-t[1])*e+")"}),l.attr("r",function(t){return t.r*e})}if(t)throw t;e=d3v4.hierarchy(e).sum(function(t){return t.size}).sort(function(t,e){return e.value-t.value});var r,i=e,o=pack(e).descendants(),l=g.selectAll("circle").data(o).enter().append("circle").attr("class",function(t){return t.parent?t.children?"node":"node node--leaf":"node node--root"}).style("fill",function(t){return t.children?color(t.depth):null}).on("click",function(t){d3.select(this).classed("node--leaf")?(topic_name=t.data.name.toLowerCase()+"-questions",updateChord(topic_name),updateHuman(topic_name),updateQuestions(topic_name),updateLine(topic_name)):(console.log(t),i!==t&&n(t),d3.event.stopPropagation(),console.log("koikoi"))}),c=(g.selectAll("text").data(o).enter().append("text").attr("class","label").style("fill-opacity",function(t){return t.parent===e?1:0}).style("display",function(t){return t.parent===e?"inline":"none"}).text(function(t){return t.data.name}),g.selectAll("circle,text"));svg.style("background","white").on("click",function(){n(e)}),a([e.x,e.y,2*e.r+margin])})</script><script src=https://d3js.org/d3.v3.min.js></script><script>function updateChord(t){function r(t){return function(r,n){e.selectAll("path.chord").filter(function(t){return t.source.index!=n&&t.target.index!=n}).style("stroke-opacity",t).style("fill-opacity",t)}}d3v3.select("#body svg").remove();var e=d3v3.select("#body").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")");d3v3.json("chord_topics.json",function(n){function a(t){return t}var o={},s={},d=[],c=0,i=[];n.forEach(function(r){r.topic==t&&(i=r.disease_list)}),self.names=[],i.forEach(function(t){t=a(t.name),t in o||(s[c]=t,o[t]=c++,names.push(t))}),i.forEach(function(t){var r=o[a(t.name)],e=d[r];if(!e){e=d[r]=[];for(var n=-1;++n<c;)e[n]=0}t.imports.forEach(function(t){e[o[a(t)]]++})}),chord.matrix(d);var l=e.selectAll("g.group").data(chord.groups).enter().append("svg:g").attr("class","group").on("mouseover",r(.02)).on("mouseout",r(.8));l.append("svg:path").style("stroke",function(t){return fill(t.index)}).style("fill",function(t){return fill(t.index)}).attr("d",arc),l.append("svg:text").each(function(t){t.angle=(t.startAngle+t.endAngle)/2}).attr("dy",".35em").attr("text-anchor",function(t){return t.angle>Math.PI?"end":null}).attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+(r0+26)+")"+(t.angle>Math.PI?"rotate(180)":"")}).text(function(t){return s[t.index]}),e.selectAll("path.chord").data(chord.chords).enter().append("svg:path").attr("class","chord").style("stroke",function(t){return d3v3.rgb(fill(t.source.index)).darker()}).style("fill",function(t){return fill(t.source.index)}).attr("d",d3v3.svg.chord().radius(r0))})}var d3v3=d3,w=600,h=500,r1=(h-110)/2,r0=r1-80,fill=d3v3.scale.category20c(),chord=d3v3.layout.chord().padding(.04).sortSubgroups(d3v3.descending).sortChords(d3v3.descending),arc=d3v3.svg.arc().innerRadius(r0).outerRadius(r0+20),svg=d3v3.select("#body").append("svg:svg").attr("class","temp_class").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")")</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js></script><script src=human_data.js></script><script>function updateLine(t){console.log("call to line chart");var e=d3v3,a={top:20,right:50,bottom:40,left:50},n=700-a.left-a.right,r=250-a.top-a.bottom,o=e.time.format("%Y-%m").parse,s=e.bisector(function(t){return t.date}).left,i=e.format(".2s"),l=function(t){return i(t)},c=e.time.scale().range([0,n]),d=e.scale.linear().range([r,0]),u=e.svg.axis().scale(c).orient("bottom"),f=e.svg.axis().scale(d).orient("left"),p=e.svg.line().x(function(t){return c(t.date)}).y(function(t){return d(t.count)}),m=e.select("#line").append("svg").attr("width",n+a.left+a.right).attr("height",r+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");e.csv("topicYear.csv",function(a,i){function g(){var t=c.invert(e.mouse(this)[0]),a=s(i,t,1),n=i[a-1],r=i[a],o=t-n.date>r.date-t?r:n;h.attr("transform","translate("+c(o.date)+","+d(o.count)+")"),h.select("text").text(l(o.count))}if(a)throw a;i.forEach(function(t){t.date=o(t.date),t.count=+t.count,t.disease=t.disease}),i=i.filter(function(e){return e.disease==t}),i.sort(function(t,e){return t.date-e.date}),c.domain([i[0].date,i[i.length-1].date]),d.domain(e.extent(i,function(t){return t.count})),m.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(u).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),m.append("g").attr("class","y axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Number of Questions"),m.append("path").datum(i).attr("class","line").attr("d",p);var h=m.append("g").attr("class","focus1").style("display","none");h.append("circle").attr("r",4.5),h.append("text").attr("x",9).attr("dy",".35em"),m.append("rect").attr("class","overlay").attr("width",n).attr("height",r).on("mouseover",function(){h.style("display",null)}).on("mouseout",function(){h.style("display","none")}).on("mousemove",g)})}</script><script src=questions.js></script>